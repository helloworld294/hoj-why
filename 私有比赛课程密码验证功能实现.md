# 私有比赛/课程密码验证功能实现

## 功能概述

为了保护私有比赛和课程的隐私，我们实现了在详情页面内的密码验证功能。用户可以直接进入私有比赛或课程的详情页面，但是简介内容只有在输入正确密码后才会加载显示。

## 实现方案

### 1. 保持原有的密码验证方式

**特点**:
- 用户可以直接点击进入私有比赛/课程的详情页面
- 在详情页面内显示密码验证表单
- 验证通过后可以查看所有内容

### 2. 保护简介内容

**文件**: `hoj-vue/src/views/oj/contest/ContestDetails.vue` 和 `hoj-vue/src/views/oj/training/TrainingDetails.vue`

**主要修改**:

#### 2.1 比赛详情页面 - 保护简介内容
```vue
<el-card class="box-card" v-if="hasPasswordAccess">
  <Markdown 
    :isAvoidXss="contest.gid != null" 
    :content="contest.description">
  </Markdown>
</el-card>
```

#### 2.2 课程详情页面 - 保护简介内容
```vue
<el-card v-if="hasPasswordAccess">
  <div slot="header">
    <span class="panel-title">{{ $t('m.Training_Introduction') }}</span>
  </div>
  <Markdown 
    :isAvoidXss="groupID" 
    :content="training.description">
  </Markdown>
</el-card>
```

### 3. 添加访问权限判断

#### 3.1 比赛详情页面 - 计算属性
```javascript
hasPasswordAccess() {
  // 如果是公开比赛，直接返回true
  if (this.contest.auth !== 'Password') {
    return true;
  }
  // 如果是管理员，直接返回true
  if (this.isContestAdmin || this.isSuperAdmin) {
    return true;
  }
  // 检查是否已经通过密码验证
  return this.$store.getters.contestIntoAccess;
}
```

#### 3.2 课程详情页面 - 计算属性
```javascript
hasPasswordAccess() {
  // 如果是公开课程，直接返回true
  if (this.training.auth !== 'Password') {
    return true;
  }
  // 如果是管理员，直接返回true
  if (this.isAuthenticated && this.training.author === this.$store.getters.userInfo.username) {
    return true;
  }
  // 检查是否已经通过密码验证
  return !this.trainingPasswordFormVisible;
}
```

### 4. 添加样式设计

#### 4.1 受保护内容的样式
```css
.password-protected-content {
  text-align: center;
  padding: 60px 20px;
  min-height: 300px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.password-protected-message {
  max-width: 400px;
}

.password-protected-message h3 {
  margin: 20px 0 10px 0;
  color: #303133;
  font-size: 20px;
  font-weight: 600;
}

.password-protected-message p {
  margin: 0;
  color: #606266;
  font-size: 14px;
  line-height: 1.5;
}
```

### 5. 国际化文本

#### 5.1 中文文本 (`hoj-vue/src/i18n/oj/zh-CN.js`)
```javascript
Content_Protected: '内容受保护',
Please_enter_password_to_view_content: '请输入密码以查看内容',
```

#### 5.2 英文文本 (`hoj-vue/src/i18n/oj/en-US.js`)
```javascript
Content_Protected: 'Content Protected',
Please_enter_password_to_view_content: 'Please enter password to view content',
```

## 功能特点

### 1. 用户体验优化
- **直接访问**: 用户可以直接进入私有比赛/课程的详情页面
- **内容隐藏**: 简介内容在未验证前完全不显示
- **简洁界面**: 未验证时界面更简洁，只显示基本信息

### 2. 安全性
- **内容保护**: 简介内容在未验证前完全不加载
- **权限判断**: 根据用户身份和验证状态控制内容显示
- **管理员特权**: 管理员可以直接查看所有内容

### 3. 兼容性
- **保持原有逻辑**: 不改变现有的密码验证流程
- **响应式设计**: 适配不同屏幕尺寸
- **国际化支持**: 支持中英文切换

## 使用流程

### 比赛访问流程
1. 用户在比赛列表页面点击私有比赛
2. 直接跳转到比赛详情页面
3. 页面显示比赛基本信息（标题、时间、状态等）
4. 简介内容区域完全不显示
5. 用户输入密码验证
6. 验证成功后简介内容正常显示

### 课程访问流程
1. 用户在课程列表页面点击私有课程
2. 直接跳转到课程详情页面
3. 页面显示课程基本信息（标题、分类、题目数量等）
4. 简介内容区域完全不显示
5. 用户输入密码验证
6. 验证成功后简介内容正常显示

## 技术实现要点

### 1. 权限判断逻辑
- **公开项目**: 直接显示所有内容
- **私有项目**: 根据验证状态决定是否显示简介
- **管理员**: 直接显示所有内容

### 2. 条件渲染
- 使用 `v-if` 控制整个简介卡片的显示
- 根据 `hasPasswordAccess` 计算属性判断权限

### 3. 状态管理
- 比赛: 使用 `contestIntoAccess` 状态
- 课程: 使用 `trainingPasswordFormVisible` 状态

## 页面设计

### 1. 视觉设计
- **锁图标**: 橙色锁图标，表示内容受保护
- **提示文字**: 清晰的标题和说明文字
- **布局**: 居中显示，美观大方

### 2. 交互设计
- **条件显示**: 根据权限状态动态显示内容
- **保持一致性**: 与现有的密码验证流程保持一致

## 总结

通过实现简介内容的完全隐藏，我们成功保护了私有比赛和课程的隐私。用户在进入详情页面后，基本信息可见，但简介内容在未验证前完全不显示。这种方式既确保了内容的安全性，又保持了界面的简洁性。
